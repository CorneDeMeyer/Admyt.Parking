@using Parking.FrontEnd.ClientService.Interface
@using Parking.FrontEnd.ClientService
@using System.Text.RegularExpressions

@inject IGateClientService _gateClientService;

<h3>Create Gate Event</h3>

<form method="post" @onsubmit="Submit" FormName="GateEventHandler">
    <div>
        <label>
            Gate Id: @_gateId
        </label>
        <br />
        <label>
            Time: @_displayDate
        </label>
        <br />
        <label>
            Number Plate: 
            <input @bind-value="plateText" />
        </label>
        <br />
        <div>
            <button type="submit">Submit</button>
        </div>
    </div>
</form>

@code {
    // This will be a gate terminal
    private readonly Guid _gateId = Guid.Parse("eb34d451-08c9-4ec0-9f56-909eb59f0741");
    
    private List<string> errors = new();

    private string? _displayDate;
    private Timer? secondstimer;

    [SupplyParameterFromForm]
    public string plateText { get; set; } = "";

    private async Task Submit()
    {
        errors = new();
        if (plateText.Length > 1 && plateText.ValidLicensePlate())
        {
            var response = await _gateClientService.ProcessGateRequest(new Domain.Models.GateEvent
            {
                GateId = _gateId,
                TimeStamp = DateTime.UtcNow,
                PlateText = plateText
            });
        }
        else
        {
            errors.Add($"License Plate {plateText} is not a valid License plate");
        }
    }

    protected override void OnInitialized()
    {
        _displayDate = DateTime.Now.ToString("hh:mm:ss tt");
    }
}
